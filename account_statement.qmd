---
format: pdf
execute:
  echo: false
  warning: false
  message: false
params:
  account: "Main Account"
  transactions_rds: ""
  startDate: !expr (Sys.Date() - 30)
  endDate: !expr (Sys.Date())
---

```{r}
#| label: prepare data

library(dplyr)
library(knitr)

df <- readRDS(params$transactions_rds)
# df <- readRDS("transactions.rds")

df <- df |> 
  filter(
    Konto == params$account,
    Datum >= params$startDate,
    Datum <= params$endDate
  )

start_balance <- tibble(
  Typ = "Anfangs-Kontostand",
  Betrag = df |> filter(Datum == min(Datum)) |> pull(Betrag)
)

end_balance <- tibble(
  Typ = "End-Kontostand",
  Betrag = sum(df$Betrag, na.rm = TRUE)
)
```

# Kontoauszug: `{r} params$account`
### Zeitraum: `{r} format(as.Date(params$startDate), "%d.%m.%Y")` â€“ `{r} format(as.Date(params$endDate), "%d.%m.%Y")`

## Buchungen

```{r}
#| label: bookings

if (nrow(df) > 0) {
  df |> 
    select(Datum, Bemerkung, Betrag) |> 
    kable()
}
```

## Zusammenfassung

```{r}
#| label: summary

if (nrow(df) > 0) {
  start_balance |> 
    bind_rows(end_balance) |> 
    kable()
}

```